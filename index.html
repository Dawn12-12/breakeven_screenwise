<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screenwise Pro Financial Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-image: 
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0, transparent 50%), 
                radial-gradient(at 100% 100%, rgba(168, 85, 247, 0.15) 0, transparent 50%);
            background-attachment: fixed;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .glass-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.2s;
        }
        .glass-input:focus {
            outline: none;
            border-color: #818cf8;
            background: rgba(0, 0, 0, 0.5);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto space-y-6">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-indigo-500/30 pb-6">
            <div>
                <h1 class="text-3xl font-bold text-white mb-1 flex items-center gap-2">
                    <i class='bx bx-calculator text-indigo-400'></i> Screenwise Financial Model
                </h1>
                <p class="text-slate-400 text-xs">Market Testing Logic • Monthly Accumulation • Exact Budget Data</p>
            </div>
            <div class="flex gap-2 mt-4 md:mt-0">
                <button onclick="saveData()" class="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs rounded transition-colors">
                    <i class='bx bx-save'></i> Save
                </button>
                <button onclick="resetData()" class="px-3 py-1.5 bg-slate-700 hover:bg-slate-600 text-white text-xs rounded transition-colors">
                    <i class='bx bx-reset'></i> Reset
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- LEFT: CONFIGURATION (5 Cols) -->
            <div class="lg:col-span-12 xl:col-span-4 space-y-6">

                <!-- 1. FIXED COSTS CONFIG -->
                <div class="glass-panel p-5 rounded-xl">
                    <h3 class="text-sm font-semibold text-pink-400 uppercase tracking-wider mb-4 border-b border-white/5 pb-2">
                        1. Fixed Budget (Tech + Mkt)
                    </h3>
                    <div class="grid grid-cols-3 gap-2 mb-2">
                        <!-- Generated by JS -->
                        <div id="fixedCostInputs" class="contents"></div>
                    </div>
                     <div class="mt-2 text-[10px] text-slate-500 italic">
                        *Months 7-12 will automatically inherit Month 6 costs.
                    </div>
                </div>

                <!-- 2. PRODUCT & COST CONFIG -->
                <div class="glass-panel p-5 rounded-xl">
                    <h3 class="text-sm font-semibold text-emerald-400 uppercase tracking-wider mb-4 border-b border-white/5 pb-2">
                        2. Pricing & Cost Config
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs">
                            <thead>
                                <tr class="text-slate-400 text-left">
                                    <th class="pb-2">Plan Name</th>
                                    <th class="pb-2">Price</th>
                                    <th class="pb-2">Var. Cost</th>
                                    <th class="pb-2">Est. Sales</th>
                                </tr>
                            </thead>
                            <tbody id="productConfigBody">
                                <!-- JS Generated -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 3. GROWTH SETTING -->
                <div class="glass-panel p-5 rounded-xl">
                     <h3 class="text-sm font-semibold text-blue-400 uppercase tracking-wider mb-2">
                        3. Post-Launch Growth
                    </h3>
                    <div class="flex items-center gap-4">
                        <div class="flex-1">
                            <input type="range" id="growthRate" min="0" max="100" value="15" class="w-full accent-blue-500 h-1 bg-slate-700 rounded-lg">
                        </div>
                        <span class="text-blue-300 font-bold font-mono" id="growthDisplay">15%</span>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-2">
                        Applies to sales volume starting Month 4 (after testing phase).
                    </p>
                </div>

            </div>

            <!-- RIGHT: ANALYSIS (7 Cols) -->
            <div class="lg:col-span-12 xl:col-span-8 space-y-6">

                <!-- KPI CARDS -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="glass-panel p-4 rounded-xl border-t-4 border-indigo-500 relative">
                        <div class="text-[10px] text-slate-400 uppercase">Testing Phase Revenue</div>
                        <div class="text-2xl font-bold text-white">$600</div>
                        <div class="text-[10px] text-indigo-300">Total for Months 1-3 (Fixed)</div>
                    </div>
                    <div class="glass-panel p-4 rounded-xl border-t-4 border-emerald-500">
                        <div class="text-[10px] text-slate-400 uppercase">Break-Even Status</div>
                        <div class="text-2xl font-bold text-white" id="beStatus">Analyzing...</div>
                        <div class="text-[10px] text-emerald-300" id="beSub">Check Table</div>
                    </div>
                    <div class="glass-panel p-4 rounded-xl border-t-4 border-pink-500">
                        <div class="text-[10px] text-slate-400 uppercase">Lowest Cash Point</div>
                        <div class="text-2xl font-bold text-pink-300" id="lowPoint">-$0</div>
                        <div class="text-[10px] text-slate-400">Valley of Death depth</div>
                    </div>
                </div>

                <!-- MAIN CHART -->
                <div class="glass-panel p-5 rounded-xl">
                     <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-white">Financial Trajectory (12 Months)</h3>
                        <div class="flex gap-4 text-[10px] text-slate-400">
                            <span class="flex items-center"><span class="w-2 h-2 rounded-full bg-indigo-500 mr-1"></span>Cumulative Cash</span>
                             <span class="flex items-center"><span class="w-2 h-2 rounded-full bg-emerald-500 mr-1"></span>Monthly Profit</span>
                        </div>
                    </div>
                    <div class="h-64 w-full">
                        <canvas id="finChart"></canvas>
                    </div>
                    <div class="mt-2 text-center text-[10px] text-slate-500">
                        Note: Months 1-3 Revenue is capped at $0, $200, $400 for testing.
                    </div>
                </div>

                <!-- ACCUMULATION TABLE -->
                <div class="glass-panel p-0 rounded-xl overflow-hidden">
                    <div class="px-5 py-3 border-b border-white/5 bg-slate-800/50">
                        <h3 class="text-sm font-bold text-slate-200">Detailed Accumulation Ledger</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-right text-xs">
                            <thead class="bg-slate-900/50 text-slate-400 font-semibold uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Period</th>
                                    <th class="px-4 py-3 text-emerald-500">Revenue</th>
                                    <th class="px-4 py-3 text-red-400">Fixed Cost</th>
                                    <th class="px-4 py-3 text-pink-400">Var. Cost</th>
                                    <th class="px-4 py-3 text-white">Net Profit</th>
                                    <th class="px-4 py-3 text-indigo-400 border-l border-white/5">ACCUMULATED</th>
                                </tr>
                            </thead>
                            <tbody id="ledgerBody" class="text-slate-300 divide-y divide-white/5">
                                <!-- Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA INITIALIZATION ---
        
        // Exact Fixed Costs from Spreadsheet (Jan-Jun)
        const initialFixedCosts = [817, 704, 764, 949, 869, 1749]; 

        // Products from Image (Premium, Ent, Basic Batch, Small Batch, Std Batch)
        const initialProducts = [
            { id: 'sub_prem', name: 'Premium Sub', price: 30.00, cost: 5.90, estimated: 15 },
            { id: 'sub_ent', name: 'Enterprise Sub', price: 40.00, cost: 11.88, estimated: 5 },
            { id: 'batch_basic', name: 'Batch Basic', price: 10.00, cost: 1.56, estimated: 20 },
            { id: 'batch_small', name: 'Batch Small', price: 15.00, cost: 2.87, estimated: 10 },
            { id: 'batch_std', name: 'Batch Std', price: 25.00, cost: 6.13, estimated: 5 }
        ];

        // Specific Revenue Caps for Testing Phase
        const subCaps = [0, 200, 400]; // M1, M2, M3 Caps

        let appState = {
            fixedCosts: [...initialFixedCosts],
            products: JSON.parse(JSON.stringify(initialProducts)),
            growthRate: 15
        };

        let chartInstance = null;

        // --- 2. CONFIGURATION UI RENDERERS ---

        function renderConfigUI() {
            // A. Fixed Costs Inputs (Months 1-6)
            const fcContainer = document.getElementById('fixedCostInputs');
            fcContainer.innerHTML = '';
            
            const monthNames = ['Jan (Dev)', 'Feb (Alpha)', 'Mar (Beta)', 'Apr (Launch)', 'May', 'Jun (Scale)'];
            
            appState.fixedCosts.forEach((cost, idx) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="text-[10px] text-slate-400 block mb-1">${monthNames[idx]}</label>
                    <div class="relative">
                        <span class="absolute left-2 top-1.5 text-xs text-slate-500">$</span>
                        <input type="number" value="${cost}" 
                            class="glass-input w-full pl-5 pr-1 py-1 rounded text-xs" 
                            onchange="updateFixedCost(${idx}, this.value)">
                    </div>
                `;
                fcContainer.appendChild(div);
            });

            // B. Product Inputs
            const prodBody = document.getElementById('productConfigBody');
            prodBody.innerHTML = '';

            appState.products.forEach((p, idx) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-white/5 transition-colors";
                tr.innerHTML = `
                    <td class="py-2 pl-1 font-medium text-slate-300">${p.name}</td>
                    <td class="py-2">
                        <input type="number" step="0.01" value="${p.price}" class="glass-input w-16 px-1 py-1 rounded text-right" onchange="updateProduct(${idx}, 'price', this.value)">
                    </td>
                    <td class="py-2">
                         <input type="number" step="0.01" value="${p.cost}" class="glass-input w-16 px-1 py-1 rounded text-right text-pink-300" onchange="updateProduct(${idx}, 'cost', this.value)">
                    </td>
                    <td class="py-2">
                         <input type="number" value="${p.estimated}" class="glass-input w-16 px-1 py-1 rounded text-right text-emerald-300" onchange="updateProduct(${idx}, 'estimated', this.value)">
                    </td>
                `;
                prodBody.appendChild(tr);
            });

            // C. Growth Slider
            document.getElementById('growthRate').value = appState.growthRate;
            document.getElementById('growthDisplay').innerText = appState.growthRate + '%';
        }

        // --- 3. STATE UPDATERS ---

        function updateFixedCost(idx, val) {
            appState.fixedCosts[idx] = parseFloat(val) || 0;
            calculateAndRender();
        }

        function updateProduct(idx, field, val) {
            appState.products[idx][field] = parseFloat(val) || 0;
            calculateAndRender();
        }

        document.getElementById('growthRate').addEventListener('input', (e) => {
            appState.growthRate = parseInt(e.target.value);
            document.getElementById('growthDisplay').innerText = appState.growthRate + '%';
            calculateAndRender();
        });

        // --- 4. CORE CALCULATION LOGIC ---

        function calculateAndRender() {
            const tableBody = document.getElementById('ledgerBody');
            tableBody.innerHTML = '';
            
            const labels = [];
            const dataAccum = [];
            const dataProfit = [];
            
            let cumulativeCash = 0;
            let lowestPoint = 0;
            let breakEvenMonth = null;

            // Arrays to hold current month sales volume for each product
            let currentVolumes = appState.products.map(p => p.estimated);

            for (let m = 1; m <= 12; m++) {
                const idx = m - 1;
                labels.push(`M${m}`);

                // 1. Determine Fixed Cost
                // Use array for 1-6, use Month 6 value for 7-12
                let fixedCost = 0;
                if (idx < 6) {
                    fixedCost = appState.fixedCosts[idx];
                } else {
                    fixedCost = appState.fixedCosts[5]; // Use Month 6 as steady state
                }

                // 2. Determine Revenue & Variable Costs
                let potentialRevenue = 0;
                let totalVarCost = 0;

                // Scale volumes if past testing phase (Month 4+)
                if (m >= 4) {
                    const growthFactor = 1 + (appState.growthRate / 100);
                    currentVolumes = currentVolumes.map(v => v * growthFactor);
                }

                // Sum up products
                appState.products.forEach((p, pIdx) => {
                    const vol = currentVolumes[pIdx];
                    potentialRevenue += (vol * p.price);
                    totalVarCost += (vol * p.cost);
                });

                // 3. Apply Testing Phase Constraints
                let finalRevenue = potentialRevenue;
                
                // Testing Logic override
                if (m === 1) {
                    finalRevenue = 0; // Forced 0
                    // Note: Var costs might still exist if we produce things, but assuming 0 users = 0 var cost usually. 
                    // However, let's assume beta testing users might cost money even if rev is 0. 
                    // For this model, let's keep var cost proportional to actual usage.
                    // If Revenue is capped, does usage drop? 
                    // Let's assume usage stays but we just don't charge. 
                    // So Var Cost remains based on volume, but Revenue is capped.
                } else if (m === 2) {
                    if (finalRevenue > 200) finalRevenue = 200;
                } else if (m === 3) {
                    if (finalRevenue > 400) finalRevenue = 400;
                }

                // 4. Calculate Bottom Line
                const totalCost = fixedCost + totalVarCost;
                const netProfit = finalRevenue - totalCost;
                cumulativeCash += netProfit;

                if (cumulativeCash < lowestPoint) lowestPoint = cumulativeCash;
                if (breakEvenMonth === null && netProfit > 0 && cumulativeCash > 0) {
                     // Strict Break Even: When Cumulative becomes positive (ROI)
                     // Or Operational Break Even: When Net Profit > 0
                     // Let's use Operational for the "Month" indicator, but ROI is the accumulation.
                }
                
                // Operational Break Even check for UI
                if(breakEvenMonth === null && netProfit > 0) breakEvenMonth = m;

                // 5. Update Charts Data
                dataAccum.push(cumulativeCash);
                dataProfit.push(netProfit);

                // 6. Render Table Row
                const tr = document.createElement('tr');
                tr.className = "hover:bg-white/5 transition-colors";
                
                // Indicators
                if (m <= 3) tr.classList.add("bg-indigo-900/10"); // Highlight testing

                tr.innerHTML = `
                    <td class="px-4 py-3 text-left border-l-4 ${m<=3 ? 'border-indigo-500' : 'border-emerald-500'}">
                        Month ${m} <span class="text-[10px] text-slate-500 block">${m<=3 ? '(Testing)' : '(Growth)'}</span>
                    </td>
                    <td class="px-4 py-3 text-emerald-400 font-mono">
                        $${Math.round(finalRevenue).toLocaleString()}
                        ${m<=3 && finalRevenue > 0 ? '<i class="bx bx-lock-alt text-[10px] opacity-50" title="Capped"></i>' : ''}
                    </td>
                    <td class="px-4 py-3 text-slate-400 font-mono">$${Math.round(fixedCost).toLocaleString()}</td>
                    <td class="px-4 py-3 text-slate-500 font-mono">$${Math.round(totalVarCost).toLocaleString()}</td>
                    <td class="px-4 py-3 font-mono ${netProfit>=0 ? 'text-emerald-300' : 'text-red-400'} font-bold">
                        $${Math.round(netProfit).toLocaleString()}
                    </td>
                    <td class="px-4 py-3 font-mono ${cumulativeCash>=0 ? 'text-white' : 'text-slate-400'} border-l border-white/5">
                        $${Math.round(cumulativeCash).toLocaleString()}
                    </td>
                `;
                tableBody.appendChild(tr);
            }

            // Update KPI Cards
            document.getElementById('lowPoint').innerText = `-$${Math.abs(Math.round(lowestPoint)).toLocaleString()}`;
            
            const beEl = document.getElementById('beStatus');
            const beSub = document.getElementById('beSub');
            if(breakEvenMonth) {
                beEl.innerText = `Month ${breakEvenMonth}`;
                beEl.className = "text-2xl font-bold text-white";
                beSub.innerText = "Operational Profitability";
            } else {
                beEl.innerText = "Not in 12 Mo";
                beEl.className = "text-2xl font-bold text-slate-500";
                beSub.innerText = "Increase sales estimates";
            }

            renderChart(labels, dataAccum, dataProfit);
        }

        // --- 5. CHARTING ---

        function renderChart(labels, accum, profit) {
            const ctx = document.getElementById('finChart').getContext('2d');
            
            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            type: 'line',
                            label: 'Cumulative Cash (ROI)',
                            data: accum,
                            borderColor: '#818cf8', // Indigo
                            backgroundColor: 'rgba(129, 140, 248, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            type: 'bar',
                            label: 'Monthly Net Profit',
                            data: profit,
                            backgroundColor: (ctx) => {
                                const val = ctx.raw;
                                return val >= 0 ? '#34d399' : '#f472b6'; // Emerald or Pink
                            },
                            borderRadius: 4,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (c) => ` ${c.dataset.label}: $${Math.round(c.raw).toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { 
                                color: '#94a3b8',
                                callback: (v) => '$' + v 
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        // --- 6. SAVE/LOAD SYSTEM ---
        
        function saveData() {
            localStorage.setItem('screenwise_state', JSON.stringify(appState));
            alert('Config saved!');
        }

        function loadData() {
            const saved = localStorage.getItem('screenwise_state');
            if(saved) {
                appState = JSON.parse(saved);
            }
            renderConfigUI();
            calculateAndRender();
        }

        function resetData() {
            if(confirm("Reset to default spreadsheet numbers?")) {
                localStorage.removeItem('screenwise_state');
                location.reload();
            }
        }

        // INIT
        loadData();

    </script>
</body>
</html>
